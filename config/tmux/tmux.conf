# =====================================================
# DUKE PAN'S ULTIMATE TMUX CONFIGURATION
# The Most Perfect Tmux Setup Ever Created
# =====================================================

# ===================== GENERAL SETTINGS =====================
# Set default terminal with 256 color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q'
set-environment -g COLORTERM "truecolor"

# Enable mouse support for modern workflow
set -g mouse on

# Set base index for windows and panes to 1
set -g base-index 1
setw -g pane-base-index 1

# Automatically renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Display messages for 4 seconds
set -g display-time 4000

# Refresh status bar every 5 seconds
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Don't exit tmux when closing a session
set -g detach-on-destroy off

# ===================== CATPPUCCIN MOCHA COLORS =====================
# Color definitions matching your i3 rice
set -g @catppuccin_rosewater "#f5e0dc"
set -g @catppuccin_flamingo "#f2cdcd"
set -g @catppuccin_pink "#f5c2e7"
set -g @catppuccin_mauve "#cba6f7"
set -g @catppuccin_red "#f38ba8"
set -g @catppuccin_maroon "#eba0ac"
set -g @catppuccin_peach "#fab387"
set -g @catppuccin_yellow "#f9e2af"
set -g @catppuccin_green "#a6e3a1"
set -g @catppuccin_teal "#94e2d5"
set -g @catppuccin_sky "#89dceb"
set -g @catppuccin_sapphire "#74c7ec"
set -g @catppuccin_blue "#89b4fa"
set -g @catppuccin_lavender "#b4befe"
set -g @catppuccin_text "#cdd6f4"
set -g @catppuccin_subtext1 "#bac2de"
set -g @catppuccin_subtext0 "#a6adc8"
set -g @catppuccin_overlay2 "#9399b2"
set -g @catppuccin_overlay1 "#7f849c"
set -g @catppuccin_overlay0 "#6c7086"
set -g @catppuccin_surface2 "#585b70"
set -g @catppuccin_surface1 "#45475a"
set -g @catppuccin_surface0 "#313244"
set -g @catppuccin_base "#1e1e2e"
set -g @catppuccin_mantle "#181825"
set -g @catppuccin_crust "#11111b"

# ===================== KEY BINDINGS =====================
# Change prefix key to Ctrl-a (more ergonomic)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Reload configuration file
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Switch panes using Alt-arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Switch panes using vim-like keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes using vim-like keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Switch windows using Shift-arrow
bind -n S-Left previous-window
bind -n S-Right next-window

# Move windows with Ctrl-Shift-arrow
bind -n C-S-Left swap-window -t -1\; select-window -t -1
bind -n C-S-Right swap-window -t +1\; select-window -t +1

# Quick window selection
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Session management
bind S choose-session
bind N new-session
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# Copy mode improvements
setw -g mode-keys vi
bind Enter copy-mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"
bind p paste-buffer

# Clear screen and history
bind C-l send-keys 'C-l'
bind C-k clear-history

# Toggle synchronize panes
bind e setw synchronize-panes

# ===================== STATUS BAR CONFIGURATION =====================
# Enable status bar
set -g status on
set -g status-position top
set -g status-justify centre

# Status bar colors
set -g status-style "bg=#{@catppuccin_base},fg=#{@catppuccin_text}"

# Left status bar - Session info with duke pan branding
set -g status-left-length 100
set -g status-left "#[bg=#{@catppuccin_mauve},fg=#{@catppuccin_base},bold] Û∞ä† DUKE PAN #[bg=#{@catppuccin_surface0},fg=#{@catppuccin_mauve}]#[bg=#{@catppuccin_surface0},fg=#{@catppuccin_text}] #S #[bg=#{@catppuccin_base},fg=#{@catppuccin_surface0}]"

# Right status bar - System info
set -g status-right-length 150
set -g status-right "#[bg=#{@catppuccin_base},fg=#{@catppuccin_surface0}]#[bg=#{@catppuccin_surface0},fg=#{@catppuccin_text}] %H:%M #[bg=#{@catppuccin_surface0},fg=#{@catppuccin_green}]#[bg=#{@catppuccin_green},fg=#{@catppuccin_base}] %d/%m #[bg=#{@catppuccin_green},fg=#{@catppuccin_blue}]#[bg=#{@catppuccin_blue},fg=#{@catppuccin_base},bold] Û∞å¢ #h "

# Window status format
setw -g window-status-format "#[bg=#{@catppuccin_surface1},fg=#{@catppuccin_text}] #I:#W "
setw -g window-status-current-format "#[bg=#{@catppuccin_base},fg=#{@catppuccin_lavender}]#[bg=#{@catppuccin_lavender},fg=#{@catppuccin_base},bold] #I:#W #[bg=#{@catppuccin_base},fg=#{@catppuccin_lavender}]"

# Window status separator
setw -g window-status-separator ""

# ===================== PANE BORDERS =====================
set -g pane-border-style "fg=#{@catppuccin_surface0}"
set -g pane-active-border-style "fg=#{@catppuccin_lavender}"

# ===================== MESSAGE STYLING =====================
set -g message-style "bg=#{@catppuccin_surface0},fg=#{@catppuccin_text}"
set -g message-command-style "bg=#{@catppuccin_surface0},fg=#{@catppuccin_text}"

# ===================== COPY MODE STYLING =====================
setw -g mode-style "bg=#{@catppuccin_surface0},fg=#{@catppuccin_text}"

# ===================== CLOCK MODE =====================
setw -g clock-mode-colour "#{@catppuccin_lavender}"
setw -g clock-mode-style 24

# ===================== ADVANCED FEATURES =====================
# Automatic window naming
setw -g automatic-rename on
set -g set-titles on
set -g set-titles-string "#T - #W"

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off
set -g activity-action other

# Bell settings
set -g bell-action any
set -g visual-bell off

# ===================== PLUGIN MANAGEMENT =====================
# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'christoomey/vim-tmux-navigator'

# Plugin configurations
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'
set -g @continuum-save-interval '15'

# CPU plugin configuration
set -g @cpu_low_icon "Û∞æÜ"
set -g @cpu_medium_icon "Û∞æÖ"
set -g @cpu_high_icon "Û∞æÑ"
set -g @cpu_low_fg_color "#{@catppuccin_green}"
set -g @cpu_medium_fg_color "#{@catppuccin_yellow}"
set -g @cpu_high_fg_color "#{@catppuccin_red}"

# Battery plugin configuration
set -g @batt_icon_status_charged 'Û∞Åπ'
set -g @batt_icon_status_charging 'Û∞ÇÑ'
set -g @batt_icon_status_discharging 'Û∞ÇÉ'
set -g @batt_color_full_charge "#{@catppuccin_green}"
set -g @batt_color_high_charge "#{@catppuccin_yellow}"
set -g @batt_color_medium_charge "#{@catppuccin_peach}"
set -g @batt_color_low_charge "#{@catppuccin_red}"

# ===================== PERFORMANCE OPTIMIZATIONS =====================
# Faster command sequences
set -s escape-time 10

# Increase repeat time for repeatable commands
set -g repeat-time 1000

# Rather than constraining window size to the maximum size of any client
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*
setw -g aggressive-resize on

# ===================== CUSTOM FUNCTIONS =====================
# Toggle status bar
bind t if -F '#{s/off//:status}' 'set status off' 'set status on'

# Zoom pane toggle
bind z resize-pane -Z

# Kill pane without confirmation
bind x kill-pane

# Kill window without confirmation
bind & kill-window

# Create new session
bind C-c new-session

# Find session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# ===================== CONDITIONAL CONFIGURATIONS =====================
# Different configurations for different environments
if-shell "test -f ~/.config/tmux/local.conf" "source ~/.config/tmux/local.conf"

# OS-specific configurations
if-shell "uname | grep -q Darwin" "source ~/.config/tmux/macos.conf"
if-shell "uname | grep -q Linux" "source ~/.config/tmux/linux.conf"

# ===================== INITIALIZATION =====================
# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'

# Display startup message
display-message "Duke Pan's Ultimate Tmux Configuration Loaded! üöÄ"
